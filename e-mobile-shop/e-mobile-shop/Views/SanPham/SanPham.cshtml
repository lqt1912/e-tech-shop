
@{
    ViewData["Title"] = "SanPham";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var context = new ClientDbContext();
    var dataAccess = new DataAccess();
}

@using e_mobile_shop.Areas.Identity.Data
@using Microsoft.AspNetCore.Identity
@inject UserManager<AppUser> UserManager
@inject SignInManager<AppUser> SignInManager
@model SanPham
<style>
    td {
        padding: 5px;
    }

    .flex-control-thumbs li img {
        max-height: 120px;
    }
</style>

<!-- Single Page -->
<div class="banner-bootom-w3-agileits py-5">
    @Html.Partial("_StatusMessages")
    <div class="container py-xl-4 py-lg-2 border">
        <!-- tittle heading -->
        <h3 class="tittle-w3l  mb-lg-5 mb-sm-4 mb-3">
            Chi tiết sản phẩm
        </h3>
        <!-- //tittle heading -->
        <div class="row">
            <div class="col-lg-5 col-md-8 single-right-left ">
                <div class="grid images_3_of_2">
                    <div class="flexslider">
                        <ul class="slides">

                            <li data-thumb="../../ProductImages/@dataAccess.GetAnhSanPham(Model.MaSp).Anh1" class="data-thumb">
                                <div class="thumb-image">
                                    <img src="~/ProductImages/@dataAccess.GetAnhSanPham(Model.MaSp).Anh1" id="" data-imagezoom="true" class="img-fluid w-100" alt="2">
                                </div>
                            </li>

                            <li data-thumb="../../ProductImages/@dataAccess.GetAnhSanPham(Model.MaSp).Anh2" class="data-thumb">
                                <div class="thumb-image">
                                    <img src="~/ProductImages/@dataAccess.GetAnhSanPham(Model.MaSp).Anh2" id="" data-imagezoom="true" class="img-fluid w-100" alt="2">
                                </div>
                            </li>


                            <li data-thumb="../../ProductImages/@dataAccess.GetAnhSanPham(Model.MaSp).Anh3" class="data-thumb">
                                <div class="thumb-image">
                                    <img src="~/ProductImages/@dataAccess.GetAnhSanPham(Model.MaSp).Anh3" id="" data-imagezoom="true" class="img-fluid w-100" alt="2">
                                </div>
                            </li>
                        </ul>

                        <div class="clearfix"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-7 single-right-left simpleCart_shelfItem">
                <h3 class="mb-3">@Model.TenSp</h3>
                <p class="mb-3">
                    <span class="item_price">@Model.GiaGoc<sup>đ</sup></span>
                    <del class="mx-2 font-weight-light">@Model.GiaTien<sup>đ</sup></del>
                </p>
                <div class="single-infoagile">
                    <ul>
                        <li class="mb-3">
                            <span style="text-transform: uppercase">Hãng sản xuất: @context.NhaSanXuat.Find(Model.Nsx).TenNsx </span>
                        </li>
                        <li class="mb-3">
                            Còn
                            <span class="item_price">@Model.SoLuong</span> sản phẩm
                        </li>

                        <li class="mb-3">
                            Đã có
                            <span class="item_price">@Model.SoLuotXemSp</span> lượt xem sản phẩm
                        </li>
                    </ul>
                </div>
                <br />

                <div class="product-single-w3l">
                    <br />

                    <ul>
                        @foreach (var item in dataAccess.GetThongSoKiThuat(Model.MaSp).Take(8))
                        {
                            if (item.GiaTri.Length <= 50)
                            {
                                <li class="mb-1">
                                    <span style="text-transform:uppercase">@context.ThongSo.Find(item.ThongSo).TenThongSo</span>  : <span style="text-transform:uppercase">@item.GiaTri</span>
                                </li>
                            }

                        }
                    </ul>
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
                        Xem cấu hình chi tiết
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel" style="color:black !important">Cấu hình chi tiết </h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <table style="width:100% ">
                                        @{
                                            var lst = dataAccess.GetThongSoKiThuat(Model.MaSp);
                                            for (int i = 0; i < lst.Count(); i++)
                                            {
                                                if (i % 2 == 0)
                                                {
                                                    <tr class="mb-1 border-bottom">
                                                        <td style="text-transform:uppercase; width: 40%">@context.ThongSo.Find(lst[i].ThongSo).TenThongSo</td>
                                                        <td style="text-transform:uppercase">@lst[i].GiaTri</td>
                                                    </tr>
                                                }
                                                else
                                                {
                                                    <tr class="mb-1 border-bottom" style="background-color:aliceblue">
                                                        <td style="text-transform:uppercase; width: 40%">@context.ThongSo.Find(lst[i].ThongSo).TenThongSo</td>
                                                        <td style="text-transform:uppercase">@lst[i].GiaTri</td>
                                                    </tr>
                                                }
                                            }
                                        }


                                    </table>

                                </div>

                            </div>
                        </div>
                    </div>

                    <p class="my-sm-4 my-3">
                        <i class="fas fa-retweet mr-3"></i>Net banking & Credit/ Debit/ ATM card
                    </p>
                </div>
                <div class="occasion-cart">
                    <div class="snipcart-details top_brand_home_details item_add single-item hvr-outline-out">
                        <form asp-action="AddToCartSession" asp-controller="GioHang" method="post">
                            <fieldset>

                                <div class="input-group">
                                    <span class="p-1 pr-2" style="font-size:15px;">Số lượng</span>
                                    <span class="input-group-btn">
                                        <button style="border-radius: 0px" type="button" class="btn btn-default btn-number" disabled="disabled" data-type="minus" data-field="quant[1]">
                                            <i class="fas fa-minus"></i>
                                        </button>
                                    </span>
                                    <input type="text" size="3" name="quant[1]" id="up_down" class="form-control input-number" value="1" min="1" max="10">

                                    <span class="input-group-btn">
                                        <button style="border-radius: 0px" type="button" class="btn btn-default btn-number" data-type="plus" data-field="quant[1]">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </span>
                                </div>
                                <div><input type="hidden" name="SanPham" value="@Model.MaSp" /></div>
                                <input type="hidden" name="SoLuong" id="SoLuong" value="1" />
                                <input style="border-radius: 0px" type="submit" name="submit" value="Thêm vào giỏ hàng" class="button mt-2" />
                            </fieldset>
                        </form>
                    </div>

                </div>

            </div>
        </div>

        <h3 class="tittle-w3l  mb-lg-5 mb-sm-4 mb-3">
            Bình luận
        </h3>
        <div style="max-height: 600px; overflow:scroll">
            @await Component.InvokeAsync("BinhLuan", new { Id = Model.MaSp })
        </div>
        <div class="mb-2 p-3" id="">
            @if (UserManager.GetUserId(User) == null)
            {
                <p style=" font-size: 15px;"><a asp-area="Identity" asp-page="/Account/Login"> Đăng nhập</a> để bình luận</p>
            }
            else
            {
                <div> Thêm bình luận </div>
            <form class="form-inline " asp-action="Comment" asp-route-maSp="@Model.MaSp" asp-controller="User" asp-route-userId="@UserManager.GetUserId(User)">
                <textarea type="text" name="Comment" class="form-control w-100"></textarea>
                <button class="btn btn-primary radius-0 mt-2" type="submit"> Gửi</button>

            </form>
            }
        </div>

    </div>
</div>
<!-- //Single Page -->

<script>
    function ReplyComment(mabl) {
        var x = document.getElementById(mabl.toString());
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
    function CancelReply(mabl) {
        var x = document.getElementById(mabl.toString());
        if (x.style.display === "none") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        }
    }
</script>